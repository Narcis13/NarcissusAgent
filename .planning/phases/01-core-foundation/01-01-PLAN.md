---
phase: 01-core-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - bunfig.toml
  - src/types.ts
  - src/pty/types.ts
  - src/session/types.ts
autonomous: true

must_haves:
  truths:
    - "bun --version returns 1.3.5 or higher"
    - "bun run typecheck passes with no errors"
    - "project structure matches recommended architecture from research"
  artifacts:
    - package.json
    - tsconfig.json
    - src/types.ts
    - src/pty/types.ts
    - src/session/types.ts
  key_links:
    - "session types use discriminated union pattern from research"
    - "PTY types align with Bun.Terminal API"
---

<objective>
Initialize project with Bun 1.3.5+, TypeScript config, and all shared type definitions for PTY and Session management.

Purpose: Establish the foundation that all other plans depend on. Types must be correct first since PTY Manager and Session Manager will implement these interfaces.

Output: Working Bun project with complete type definitions ready for implementation.
</objective>

<execution_context>
@/Users/narcisbrindusescu/.claude/looppool/workflows/execute-plan.md
@/Users/narcisbrindusescu/.claude/looppool/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Bun project and upgrade runtime</name>
  <files>package.json, tsconfig.json, bunfig.toml</files>
  <action>
    1. Run `bun upgrade` to ensure Bun 1.3.5+ (required for Terminal API)
    2. Run `bun init -y` to create package.json
    3. Run `bun add hono` (HTTP server for Phase 1 REST API)
    4. Run `bun add -d @types/bun typescript` for type support
    5. Create tsconfig.json with strict mode, ESNext target, Bun types
    6. Update package.json:
       - name: "claude-code-orchestrator"
       - Add "bin": { "cco": "./src/index.ts" }
       - Add scripts: "start", "dev", "typecheck"
    7. Create bunfig.toml with telemetry disabled
    8. Create folder structure: src/pty/, src/session/, src/server/
  </action>
  <verify>
    bun --version | grep -E "^1\.(3\.[5-9]|[4-9]|[1-9][0-9])" && echo "Bun version OK"
    bun run typecheck
  </verify>
  <done>
    - Bun is 1.3.5+
    - package.json exists with hono dependency and bin entry
    - tsconfig.json exists with strict mode
    - Folder structure created
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared type definitions</name>
  <files>src/types.ts, src/pty/types.ts, src/session/types.ts</files>
  <action>
    Create type definitions following patterns from 01-RESEARCH.md:

    **src/types.ts** - Shared types across modules:
    ```typescript
    // Re-export all types for convenient imports
    export * from "./pty/types";
    export * from "./session/types";
    ```

    **src/pty/types.ts** - PTY Manager types:
    ```typescript
    export interface PTYManagerOptions {
      command: string[];
      onData: (data: Uint8Array) => void;
      onExit: (exitCode: number | null, signalCode: string | null) => void;
      cols?: number;
      rows?: number;
    }

    export interface PTYManager {
      spawn(options: PTYManagerOptions): Promise<void>;
      write(data: string): void;
      cleanup(): Promise<void>;
      readonly isRunning: boolean;
      readonly exitCode: number | null;
    }
    ```

    **src/session/types.ts** - Session state discriminated union:
    ```typescript
    // Discriminated union for type-safe state machine
    export type SessionState =
      | { status: "idle" }
      | { status: "task_running"; taskDescription: string; startTime: Date }
      | { status: "analyzing" }
      | { status: "injecting"; command: string }
      | { status: "error"; error: string; previousStatus: SessionStatus };

    export type SessionStatus = SessionState["status"];

    export interface SessionMetadata {
      taskDescription: string;
      startTime: Date;
      runtime: number; // milliseconds
    }

    export interface SessionInfo {
      state: SessionState;
      metadata: SessionMetadata | null;
    }

    // Valid state transitions map
    export const VALID_TRANSITIONS: Record<SessionStatus, SessionStatus[]> = {
      idle: ["task_running", "error"],
      task_running: ["analyzing", "idle", "error"],
      analyzing: ["injecting", "idle", "error"],
      injecting: ["task_running", "error"],
      error: ["idle"],
    };
    ```
  </action>
  <verify>
    bun run typecheck
    grep -l "SessionState" src/session/types.ts
    grep -l "PTYManagerOptions" src/pty/types.ts
  </verify>
  <done>
    - All type files exist and compile without errors
    - SessionState is a discriminated union with status field
    - VALID_TRANSITIONS map is exported
    - PTYManagerOptions interface matches Bun.Terminal API needs
  </done>
</task>

</tasks>

<verification>
Run these commands to verify plan completion:

```bash
# Bun version check
bun --version

# Type check passes
bun run typecheck

# All expected files exist
ls -la package.json tsconfig.json src/types.ts src/pty/types.ts src/session/types.ts

# Hono is installed
grep "hono" package.json
```
</verification>

<success_criteria>
1. Bun runtime is 1.3.5 or higher
2. `bun run typecheck` passes with zero errors
3. All type files exist: src/types.ts, src/pty/types.ts, src/session/types.ts
4. SessionState uses discriminated union pattern
5. package.json has hono dependency and cco bin entry
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-foundation/01-01-SUMMARY.md`
</output>
